# Word Export Feature Guide

## Overview

The Audio Scribe AI application now supports exporting transcription results to Microsoft Word documents (.docx) in addition to JSON format. This feature allows you to create professionally formatted transcription reports with customizable templates.

## Features

- **Export to Word**: Generate formatted Word documents from transcription results
- **Custom Templates**: Use your own Word templates to control document formatting
- **Default Formatting**: Built-in professional formatting when no template is provided
- **Speaker Labels**: Speaker names are preserved and formatted
- **Timestamps**: Each segment includes start and end timestamps
- **Metadata**: Documents include audio duration, number of speakers, language, and export date

## Quick Start

### 1. Install Dependencies

First, ensure you have the required Python package installed:

```bash
pip install python-docx==1.1.0
```

Or install all requirements:

```bash
pip install -r requirements.txt
```

### 2. Generate Default Template (Optional)

To create the default Word template:

```bash
cd backend/templates
python create_default_template.py
```

This will create `backend/templates/word/default_template.docx`.

### 3. Using the Export Feature

After transcribing audio:

1. Click the **"Export to Word"** button in the results section
2. The Word document will be automatically downloaded
3. The file will be named with a timestamp: `transcription_YYYYMMDD_HHMMSS.docx`

You can also export to JSON by clicking the **"Export JSON"** button.

## Document Format

### Default Format

When no template is provided, documents include:

**Header Section:**
- Title: "Transcription Report"
- Metadata table with:
  - Export Date
  - Duration
  - Number of Speakers
  - Language
  - Total Segments

**Transcription Section:**
- Speaker name (bold, blue text)
- Timestamp range [MM:SS - MM:SS]
- Transcribed text (indented)
- Proper spacing between segments

**Footer:**
- "Generated by Audio Scribe AI"

## Custom Templates

### Creating a Custom Template

You can create your own Word templates with the following placeholders:

#### Available Placeholders:

- `{{title}}` - Document title
- `{{date}}` - Export date and time
- `{{duration}}` - Audio duration in seconds
- `{{num_speakers}}` - Number of detected speakers
- `{{language}}` - Detected language
- `{{total_segments}}` - Total number of segments
- `{{TRANSCRIPTION}}` - **Special marker** where transcription segments will be inserted

#### Example Template Structure:

```
# {{title}}

## Metadata
| Field | Value |
|-------|-------|
| Date | {{date}} |
| Duration | {{duration}} |
| Speakers | {{num_speakers}} |
| Language | {{language}} |

## Transcription

{{TRANSCRIPTION}}

---
Footer text here
```

### Using a Custom Template

1. Create your Word document with placeholders
2. Save it in `backend/templates/word/` directory
3. Name it something descriptive (e.g., `my_custom_template.docx`)

The template will be automatically used if specified in the API call, or you can modify the code to use it by default.

### Template Tips:

- Use Word's built-in styles for consistent formatting
- The `{{TRANSCRIPTION}}` marker should be on its own line
- Text before and after `{{TRANSCRIPTION}}` will be preserved
- Placeholders can be used anywhere in the document (headers, footers, tables, etc.)

## API Usage

### Export Endpoint

**POST** `/api/export/word`

**Request Body:**
```json
{
  "transcription_data": {
    "segments": [
      {
        "speaker": "Speaker 1",
        "start": 0.0,
        "end": 5.5,
        "text": "Hello, this is a transcription."
      }
    ],
    "duration": 120.5,
    "num_speakers": 2,
    "language": "en"
  },
  "template_name": "custom_template.docx"  // Optional
}
```

**Response:**
- File download with MIME type: `application/vnd.openxmlformats-officedocument.wordprocessingml.document`
- Filename: `transcription_YYYYMMDD_HHMMSS.docx`

### Get Available Templates

**GET** `/api/export/templates`

**Response:**
```json
{
  "success": true,
  "templates": [
    "default_template.docx",
    "custom_template.docx"
  ]
}
```

## File Structure

```
backend/
├── services/
│   └── export_service.py        # Export service implementation
├── templates/
│   ├── create_default_template.py  # Template generator script
│   └── word/
│       └── default_template.docx   # Default template (generated)
exports/                             # Temporary export files
```

## Troubleshooting

### "Failed to export to Word" Error

1. Check that `python-docx` is installed: `pip install python-docx`
2. Ensure the `exports/` directory exists and is writable
3. Check backend logs for detailed error messages

### Template Not Found

1. Verify template exists in `backend/templates/word/`
2. Check filename spelling (case-sensitive)
3. Ensure template is a valid .docx file

### Formatting Issues

1. Verify template placeholders use correct syntax: `{{placeholder}}`
2. Ensure `{{TRANSCRIPTION}}` marker is present and on its own line
3. Test with default format first to isolate template issues

## Advanced Usage

### Programmatic Export

You can use the `ExportService` class directly in Python:

```python
from services.export_service import ExportService
from pathlib import Path

export_service = ExportService()

# Export with default format
output_path = export_service.export_to_word(
    transcription_data=data,
    output_path=Path("my_transcription.docx")
)

# Export with custom template
template_path = Path("backend/templates/word/custom_template.docx")
output_path = export_service.export_to_word(
    transcription_data=data,
    template_path=template_path,
    output_path=Path("my_transcription.docx")
)
```

### Batch Export

You can process multiple transcriptions:

```python
for transcription in transcription_list:
    export_service.export_to_word(
        transcription_data=transcription,
        output_path=Path(f"export_{transcription['id']}.docx")
    )
```

## Future Enhancements

Potential improvements:

- [ ] Template selection in UI
- [ ] Custom styling options
- [ ] Export to PDF
- [ ] Multi-language support in templates
- [ ] Export statistics and visualizations
- [ ] Batch export multiple files

## Support

For issues or questions:
- Check the main [README.md](README.md) for general setup
- Review backend logs in the console
- Verify all dependencies are installed

## License

Same as the main project.
